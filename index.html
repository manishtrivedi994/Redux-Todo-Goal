<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
	<title>Udacity Todos Goals</title>
</head>
<body>
	<div>
		<h1>Todos List</h1>
		<input id="todo" type="text" placeholder="Add Todo"/>
		<button id="todoBtn">Add Todo</button>
		<ul id="todos">

		</ul>
	</div>
	<div>
		<h1>Goals List</h1>
		<input id="goal" type="text" placeholder="Add Goal"/>
		<button id="goalBtn">Add Goal</button>
		<ul id="goals">

		</ul>		
	</div>
	<script type="text/javascript">

		function generateId() {
			return Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
		}
		//Library Code
		function createStore (reducer) {
		
			  // The store should have four parts
		  	  // 1. The state
		      // 2. Get the state.
		      // 3. Listen to changes on the state.
		      // 4. Update the state
			let state
			let listeners = []
		
			const getState = () => state
		
			const subscribe = (listener) => {
				listeners.push(listener)
				return () => {
		      		listeners = listeners.filter((l) => l !== listener)
		    	}
			}
		
			//Responsible for updating the state
			const dispatch= (action) => {
				state = reducer(state, action)
				listeners.forEach((listener) => listener())
			}
		
			return {
				getState,
				subscribe,
				dispatch
			}
		}
		
		
		//App Code
		const ADD_TODO = 'ADD_TODO'
		const REMOVE_TODO = 'REMOVE_TODO'
		const TOGGLE_TODO = 'TOGGLE_TODO'
		const ADD_GOAL = 'ADD_GOAL'
		const REMOVE_GOAL = 'REMOVE_GOAL'
		
		function addTodoAction (todo) {
			return {
				type: ADD_TODO,
				todo,
			}
		}
		function removeTodoAction (id) {
			return {
				type: REMOVE_TODO,
				id,
			}
		}
		function toggleTodoAction (id) {
			return {
				type: TOGGLE_TODO,
				id,
			}
		}
		
		function addGoalAction (goal) {
			return {
				type: ADD_GOAL,
				goal,
			}
		}
		
		function removeGoalAction (id) {
			return {
				type: REMOVE_GOAL,
				id,
			}
		}
		
		function todos (state = [], action) {
			switch(action.type) {
				case ADD_TODO:
					return state.concat([action.todo]);
				case REMOVE_TODO:
					return state.filter((todo) => todo.id !== action.id);
				case TOGGLE_TODO:
					return state.map((todo) => todo.id !== action.id ? todo :
		        Object.assign({}, todo, { complete: !todo.complete }))
				default :
					return state;	
			}
		}
		
		function goals (state = [], action) {
			switch(action.type) {
				case ADD_GOAL:
					return state.concat([action.goal]);
				case REMOVE_GOAL:
					return state.filter((goal) => goal.id !== action.id);
				default :
					return state;	
			}
		}
		
		//This is a root reducer which is pass all the reducer in the createStore() method
		function app (state = {}, action) {
			return {
				todos: todos(state.todos, action),
				goals: goals(state.goals, action),
			}
		}
		
		const store = createStore(app)
		
		//This function is invoked whenever the state changes
		store.subscribe(() => {
			//console.log('The new state is: ',store.getState());
			const { todos, goals } = store.getState()

			document.getElementById('todos').innerHTML = ''
			document.getElementById('goals').innerHTML = ''

			todos.forEach(addTodoToDOM)
			goals.forEach(addGoalToDOM)
		})
		
//		store.dispatch (addTodoAction ({
//			id: 0,
//			name: 'Learn Redux',
//			complete: false
//			
//		}))
//		
//		store.dispatch (addTodoAction({
//			id: 1,
//			name: 'Walk the dog',
//			complete: false
//		}))
//		
//		store.dispatch(addTodoAction({
//			id: 2,
//			name: 'Read a book',
//			complete: false
//		}))
//		
//		store.dispatch(removeTodoAction(1))
//		
//		store.dispatch (toggleTodoAction(1))
//		
//		
//		store.dispatch (addGoalAction({
//			id: 0,
//			name: 'Get a good job'
//		}))
//		
//		store.dispatch (addGoalAction({
//			id: 1,
//			name: 'Build a home'
//			
//		}))
//		
//		store.dispatch (removeGoalAction(1))

		//DOM Code
		function addTodo () {
			const input = document.getElementById('todo')
			const name = input.value
			input.value = ''

			store.dispatch(addTodoAction({
				name,
				complete: false,
				id: generateId()
			}))
		}

		function addGoal () {
			const input = document.getElementById('goal')
			const name = input.value
			input.value = ''
			
			store.dispatch(addGoalAction({
				name,
				id: generateId()
			}))	
		}

		document.getElementById('todoBtn')
			.addEventListener('click', addTodo)
		
		document.getElementById('goalBtn')
			.addEventListener('click', addGoal)

		function createRemoveButton (onClick) {
			const removeBtn = document.createElement('button')
			removeBtn.innerHTML = 'X'
			removeBtn.addEventListener('click', onClick)
			return removeBtn
		}

		//To add todo items to the DOM
		function addTodoToDOM(todo) {
			const node = document.createElement('li')
			const text = document.createTextNode(todo.name)

			removeBtn = createRemoveButton(() => {
				store.dispatch(removeTodoAction(todo.id))
			})

			node.appendChild(text)
			node.appendChild(removeBtn)
			//strike through line if the todo.complete: true (toggle feature)
			node.style.textDecoration = todo.complete ? 'line-through' : 'none'
			node.addEventListener('click', () => {
				store.dispatch(toggleTodoAction(todo.id))
			})

			document.getElementById('todos')
				.appendChild(node)
		}
		//To add goal items to the DOM
		function addGoalToDOM(goal) {
			const node = document.createElement('li')
			const text = document.createTextNode(goal.name)
			const removeBtn = createRemoveButton(() => {
				store.dispatch(removeGoalAction(goal.id))
			})

			node.appendChild(text)
			node.appendChild(removeBtn)

			document.getElementById('goals')
				.appendChild(node)
		}



	</script>

</body>
</html>